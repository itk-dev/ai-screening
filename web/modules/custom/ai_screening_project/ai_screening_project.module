<?php

/**
 * @file
 * Hooks related to this module.
 */

use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\ai_screening_project\Helper\ProjectHelper;
use Drupal\core_event_dispatcher\Event\Entity\EntityBaseFieldInfoEvent;

/**
 * Implements hook_entity_base_field_info().
 */
function ai_screening_project_entity_base_field_info(EntityTypeInterface $entityType): array {
  // @fixme I, Mikkel, cannot make this work using an event handler, but we can
  // get the fields data from the event handler.
  // Only add fields for node entities to avoid unnecessary processing.
  if ($entityType->id() !== 'node') {
    return [];
  }

  // Avoid circular dependency during container compilation by checking if
  // the service is available. During site installation, the container may
  // not be fully built yet.
  try {
    /** @var \Drupal\ai_screening_project\Helper\ProjectHelper $helper */
    $helper = \Drupal::service(ProjectHelper::class);
    $event = new EntityBaseFieldInfoEvent($entityType);
    $helper->entityBaseFieldInfo($event);
    return $event->getFields();
  }
  catch (\Exception $e) {
    // Service not available yet (e.g., during installation),
    // return an empty array.
    return [];
  }
}
